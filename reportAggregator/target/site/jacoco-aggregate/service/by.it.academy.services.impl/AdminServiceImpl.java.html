<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>AdminServiceImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">reportAggregator</a> &gt; <a href="../index.html" class="el_bundle">service</a> &gt; <a href="index.source.html" class="el_package">by.it.academy.services.impl</a> &gt; <span class="el_source">AdminServiceImpl.java</span></div><h1>AdminServiceImpl.java</h1><pre class="source lang-java linenums">package by.it.academy.services.impl;

import by.it.academy.repository.dao.AdminDao;
import by.it.academy.repository.dao.DaoProvider;
import by.it.academy.repository.dao.EntityDao;
import by.it.academy.repository.entity.Admin;
import by.it.academy.repository.entity.Course;
import by.it.academy.repository.entity.Mentor;
import by.it.academy.repository.util.HibernateUtil;
import by.it.academy.services.AdminService;
import by.it.academy.services.dto.AdminCourseDto;
import by.it.academy.services.dto.AdminDto;
import by.it.academy.services.dto.AdminMentorDto;

import javax.persistence.EntityManager;
import javax.persistence.Query;
import java.util.List;
import java.util.Scanner;
import java.util.stream.Collectors;

<span class="nc" id="L21">public class AdminServiceImpl implements AdminService {</span>

    /**
     *
     */
<span class="nc" id="L26">    private static EntityDao&lt;Mentor&gt; mentorEntityDao = null;</span>
    /**
     *
     */
<span class="nc" id="L30">    private static EntityDao&lt;Course&gt; courseEntityDao = null;</span>
    /**
     *
     */
<span class="nc" id="L34">    private static EntityDao&lt;Admin&gt; adminEntityDao = null;</span>
    /**
     *
     */
<span class="nc" id="L38">    private Scanner scanner = new Scanner(System.in);</span>

    @Override
    public List&lt;AdminDto&gt; showAllAdminDto() {
<span class="nc" id="L42">        List&lt;AdminDto&gt; result = null;</span>
<span class="nc" id="L43">        AdminDao adminDao = DaoProvider.getInstance().getAdminDao();</span>
<span class="nc" id="L44">        result = adminDao.findAll().stream()</span>
<span class="nc" id="L45">                .map(AdminDto::new)</span>
<span class="nc" id="L46">                .collect(Collectors.toList());</span>
<span class="nc" id="L47">        adminDao.closeDao();</span>
<span class="nc" id="L48">        return result;</span>
    }

    @Override
    public List&lt;AdminCourseDto&gt; allCourseFromAdmin(Integer adminId) {
<span class="nc" id="L53">            AdminDao adminDao = DaoProvider.getInstance().getAdminDao();</span>
<span class="nc" id="L54">            List&lt;AdminCourseDto&gt; courseFromAdmin = null;</span>
<span class="nc" id="L55">            courseFromAdmin = adminDao.showAllCourseAdmin(adminId).stream()</span>
<span class="nc" id="L56">                    .map(AdminCourseDto::new)</span>
<span class="nc" id="L57">                    .collect(Collectors.toList());</span>
<span class="nc" id="L58">            adminDao.closeDao();</span>
<span class="nc" id="L59">            return courseFromAdmin;</span>
    }

    @Override
    public List&lt;AdminMentorDto&gt; allMentorFromAdmin(Integer mentorId) {
<span class="nc" id="L64">        AdminDao adminDao = DaoProvider.getInstance().getAdminDao();</span>
<span class="nc" id="L65">        List&lt;AdminMentorDto&gt; mentorFromAdmin = null;</span>
<span class="nc" id="L66">        mentorFromAdmin = adminDao.showAllMentorAdmin(mentorId).stream()</span>
<span class="nc" id="L67">                .map(AdminMentorDto::new)</span>
<span class="nc" id="L68">                .collect(Collectors.toList());</span>
<span class="nc" id="L69">        adminDao.closeDao();</span>
<span class="nc" id="L70">        return mentorFromAdmin;</span>
    }

    @Override
    public void createAdmin(String nameCourse)
            throws SecurityException {
<span class="nc" id="L76">        adminEntityDao = DaoProvider.getInstance().getAdminDao();</span>
<span class="nc" id="L77">        Admin newAdmin = Admin.builder()</span>
<span class="nc" id="L78">                .adminName(nameCourse)</span>
<span class="nc" id="L79">                .build();</span>
<span class="nc" id="L80">        adminEntityDao.save(newAdmin);</span>
<span class="nc" id="L81">        adminEntityDao.closeDao();</span>
<span class="nc" id="L82">    }</span>

    @Override
    public void createCourse(String nameCourse)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L88">                DaoProvider.getInstance().getCourseDao();</span>
<span class="nc" id="L89">        Course course = Course.builder()</span>
<span class="nc" id="L90">                .courseProgram(nameCourse)</span>
<span class="nc" id="L91">                .build();</span>
<span class="nc" id="L92">        courseEntityDao.save(course);</span>
<span class="nc" id="L93">        courseEntityDao.closeDao();</span>
<span class="nc" id="L94">    }</span>

    /**
     * @param idCourse
     */
    @Override
    public void deleteCourseById(int idCourse)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L103">                DaoProvider.getInstance().getCourseDao();</span>
<span class="nc" id="L104">        List&lt;Course&gt; listCourse = courseEntityDao.findAll();</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">        for (int i = 0; i &lt; listCourse.size(); i++) {</span>
<span class="nc" id="L106">            System.out.println((listCourse.get(i)).toString());</span>
        }
<span class="nc" id="L108">        System.out.println(</span>
                &quot;Choose id of a mentor which do you prefer dismiss:&quot;);

<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null) {</span>
<span class="nc" id="L112">            courseEntityDao.delete(idCourse);</span>
<span class="nc" id="L113">            System.out.println(&quot;Course deleted with a input id.&quot;);</span>
        } else {
<span class="nc" id="L115">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L117">        courseEntityDao.closeDao();</span>
<span class="nc" id="L118">    }</span>

    /**
     *
     */
    @Override
    public void deleteCourseByName()
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L127">                DaoProvider.getInstance().getCourseDao();</span>
<span class="nc" id="L128">        List&lt;Course&gt; listCourse = courseEntityDao.findAll();</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">        for (int i = 0; i &lt; listCourse.size(); i++) {</span>
<span class="nc" id="L130">            System.out.println((listCourse.get(i)).toString());</span>
        }
<span class="nc" id="L132">        System.out.println(</span>
                &quot;Choose id of a course which do you prefer dismiss:&quot;);

<span class="nc" id="L135">        int idCourse = scanner.nextInt();</span>

<span class="nc bnc" id="L137" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null) {</span>
<span class="nc" id="L138">            courseEntityDao.delete(idCourse);</span>
<span class="nc" id="L139">            System.out.println(&quot;Course deleted.&quot;);</span>
        }

<span class="nc" id="L142">        courseEntityDao.closeDao();</span>
<span class="nc" id="L143">    }</span>

    /**
     *
     */
    @Override
    public void createMentor(String nameMentor)
            throws SecurityException {
        mentorEntityDao =
<span class="nc" id="L152">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc" id="L153">        Mentor mentor = Mentor.builder()</span>
<span class="nc" id="L154">                .mentorName(nameMentor)</span>
<span class="nc" id="L155">                .build();</span>
<span class="nc" id="L156">        mentorEntityDao.save(mentor);</span>
<span class="nc" id="L157">        mentorEntityDao.closeDao();</span>
<span class="nc" id="L158">    }</span>

    /**
     * @param idMentor
     */
    @Override
    public void deleteMentorById(int idMentor)
            throws SecurityException {
        mentorEntityDao =
<span class="nc" id="L167">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        if (mentorEntityDao.findById(idMentor) != null) {</span>
<span class="nc" id="L169">            mentorEntityDao.delete(idMentor);</span>
<span class="nc" id="L170">            System.out.println(&quot;Mentor deleted with a input id.&quot;);</span>
        } else {
<span class="nc" id="L172">            System.out.println(&quot;Mentor doesn't exist!&quot;);</span>
        }
<span class="nc" id="L174">        mentorEntityDao.closeDao();</span>
<span class="nc" id="L175">    }</span>

    /**
     *
     */
    @Override
    public void deleteMentorByName()
            throws SecurityException {
        mentorEntityDao =
<span class="nc" id="L184">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc" id="L185">        List&lt;Mentor&gt; listMentor = mentorEntityDao.findAll();</span>
<span class="nc bnc" id="L186" title="All 2 branches missed.">        for (int i = 0; i &lt; listMentor.size(); i++) {</span>
<span class="nc" id="L187">            System.out.println((listMentor.get(i)).toString());</span>
        }
<span class="nc" id="L189">        System.out.println(</span>
                &quot;Choose id of a mentor which do you prefer dismiss:&quot;);
<span class="nc" id="L191">        int idMentor = scanner.nextInt();</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">        if (mentorEntityDao.findById(idMentor) != null) {</span>
<span class="nc" id="L193">            List&lt;Course&gt; courseList = getListMentor(mentorEntityDao</span>
<span class="nc" id="L194">                    .findById(idMentor).getMentorName());</span>
<span class="nc bnc" id="L195" title="All 2 branches missed.">            for (Course course : courseList) {</span>
<span class="nc" id="L196">                course.setMentorField(null);</span>
<span class="nc" id="L197">                courseEntityDao.update(course);</span>
<span class="nc" id="L198">            }</span>
<span class="nc" id="L199">            mentorEntityDao.delete(idMentor);</span>
<span class="nc" id="L200">            System.out.println(&quot;Mentor deleted.&quot;);</span>
        }
<span class="nc" id="L202">        mentorEntityDao.closeDao();</span>
<span class="nc" id="L203">    }</span>

    /**
     *
     */
    @Override
    public void insertMentorToCourse(int idCourse, int idMentor)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L212">                DaoProvider.getInstance().getCourseDao();</span>
        mentorEntityDao =
<span class="nc" id="L214">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null</span>
<span class="nc bnc" id="L216" title="All 2 branches missed.">                &amp;&amp; mentorEntityDao.findById(idMentor) != null) {</span>
<span class="nc" id="L217">            Course course = courseEntityDao.findById(idCourse);</span>
<span class="nc" id="L218">            Mentor mentor = mentorEntityDao.findById(idMentor);</span>
<span class="nc" id="L219">            course.setMentorField(mentor);</span>
<span class="nc" id="L220">            courseEntityDao.save(course);</span>
<span class="nc" id="L221">            System.out.println(&quot;Mentor was added on course&quot;);</span>
<span class="nc" id="L222">        } else {</span>
<span class="nc" id="L223">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L225">        courseEntityDao.closeDao();</span>
<span class="nc" id="L226">    }</span>

    /**
     * @param idAdmin
     */
    @Override
    public void takeCourseForControl(int idAdmin)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L235">                DaoProvider.getInstance().getCourseDao();</span>
        adminEntityDao =
<span class="nc" id="L237">                DaoProvider.getInstance().getAdminDao();</span>
<span class="nc" id="L238">        System.out.println(&quot;Введите id курса:&quot;);</span>
<span class="nc" id="L239">        int idCourse = scanner.nextInt();</span>
<span class="nc bnc" id="L240" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null</span>
<span class="nc bnc" id="L241" title="All 2 branches missed.">                &amp;&amp; adminEntityDao.findById(idAdmin) != null) {</span>
<span class="nc" id="L242">            Course course = courseEntityDao.findById(idCourse);</span>
<span class="nc" id="L243">            Admin admin = adminEntityDao.findById(idAdmin);</span>
<span class="nc" id="L244">            course.setAdminField(admin);</span>
<span class="nc" id="L245">            courseEntityDao.save(course);</span>
<span class="nc" id="L246">            System.out.println(&quot;Admin was added on course&quot;);</span>
<span class="nc" id="L247">        } else {</span>
<span class="nc" id="L248">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L250">        courseEntityDao.closeDao();</span>

<span class="nc" id="L252">    }</span>

    @Override
    public void updateMentorToCourse(int idCourse, int idMentor)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L258">                DaoProvider.getInstance().getCourseDao();</span>
        mentorEntityDao =
<span class="nc" id="L260">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">                &amp;&amp; mentorEntityDao.findById(idMentor) != null) {</span>
<span class="nc" id="L263">            Course course = courseEntityDao.findById(idCourse);</span>
<span class="nc" id="L264">            Mentor mentor = mentorEntityDao.findById(idMentor);</span>
<span class="nc" id="L265">            course.setMentorField(mentor);</span>
<span class="nc" id="L266">            courseEntityDao.update(course);</span>
<span class="nc" id="L267">            System.out.println(&quot;Update mentor.&quot;);</span>
<span class="nc" id="L268">        } else {</span>
<span class="nc" id="L269">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L271">        courseEntityDao.closeDao();</span>
<span class="nc" id="L272">    }</span>

    @Override
    public void updateAdminToCourse(int idCourse, int idAdmin)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L278">                DaoProvider.getInstance().getCourseDao();</span>
        adminEntityDao =
<span class="nc" id="L280">                DaoProvider.getInstance().getAdminDao();</span>
<span class="nc bnc" id="L281" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null</span>
<span class="nc bnc" id="L282" title="All 2 branches missed.">                &amp;&amp; adminEntityDao.findById(idAdmin) != null) {</span>
<span class="nc" id="L283">            Course course = courseEntityDao.findById(idCourse);</span>
<span class="nc" id="L284">            Admin admin = adminEntityDao.findById(idAdmin);</span>
<span class="nc" id="L285">            course.setAdminField(admin);</span>
<span class="nc" id="L286">            courseEntityDao.update(course);</span>
<span class="nc" id="L287">            System.out.println(&quot;Update admin.&quot;);</span>
<span class="nc" id="L288">        } else {</span>
<span class="nc" id="L289">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L291">        courseEntityDao.closeDao();</span>
<span class="nc" id="L292">    }</span>

    private List&lt;Course&gt; getListMentor(String mentor)
            throws SecurityException {
<span class="nc" id="L296">        EntityManager entityManager = HibernateUtil.getEntityManager();</span>
<span class="nc" id="L297">        Query query = entityManager</span>
<span class="nc" id="L298">                .createQuery(&quot;SELECT E.courses FROM Mentor E &quot; +</span>
                        &quot;WHERE E.mentorName = :mentor&quot;);
<span class="nc" id="L300">        query.setParameter(&quot;mentor&quot;, mentor);</span>
<span class="nc" id="L301">        List&lt;Course&gt; courseList = query.getResultList();</span>
<span class="nc" id="L302">        entityManager.close();</span>
<span class="nc" id="L303">        return courseList;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>