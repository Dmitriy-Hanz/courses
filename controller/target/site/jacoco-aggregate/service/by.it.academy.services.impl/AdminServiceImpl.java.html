<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>AdminServiceImpl.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">controller</a> &gt; <a href="../index.html" class="el_bundle">service</a> &gt; <a href="index.source.html" class="el_package">by.it.academy.services.impl</a> &gt; <span class="el_source">AdminServiceImpl.java</span></div><h1>AdminServiceImpl.java</h1><pre class="source lang-java linenums">package by.it.academy.services.impl;

import by.it.academy.repository.dao.AdminDao;
import by.it.academy.repository.dao.DaoProvider;
import by.it.academy.repository.dao.EntityDao;
import by.it.academy.repository.entity.Admin;
import by.it.academy.repository.entity.Course;
import by.it.academy.repository.entity.Mentor;
import by.it.academy.repository.util.HibernateUtil;
import by.it.academy.services.AdminService;
import by.it.academy.services.dto.AdminCourseDto;
import by.it.academy.services.dto.AdminDto;

import javax.persistence.EntityManager;
import javax.persistence.Query;
import java.util.List;
import java.util.Scanner;
import java.util.stream.Collectors;

<span class="nc" id="L20">public class AdminServiceImpl implements AdminService {</span>

    /**
     *
     */
<span class="nc" id="L25">    private static EntityDao&lt;Mentor&gt; mentorEntityDao = null;</span>
    /**
     *
     */
<span class="nc" id="L29">    private static EntityDao&lt;Course&gt; courseEntityDao = null;</span>
    /**
     *
     */
<span class="nc" id="L33">    private static EntityDao&lt;Admin&gt; adminEntityDao = null;</span>
    /**
     *
     */
<span class="nc" id="L37">    private Scanner scanner = new Scanner(System.in);</span>

    @Override
    public List&lt;AdminDto&gt; showAllAdminDto() {
<span class="nc" id="L41">        List&lt;AdminDto&gt; result = null;</span>
<span class="nc" id="L42">        AdminDao adminDao = DaoProvider.getInstance().getAdminDao();</span>
<span class="nc" id="L43">        result = adminDao.findAll().stream()</span>
<span class="nc" id="L44">                .map(AdminDto::new)</span>
<span class="nc" id="L45">                .collect(Collectors.toList());</span>
<span class="nc" id="L46">        adminDao.closeDao();</span>
<span class="nc" id="L47">        return result;</span>
    }

    @Override
    public List&lt;AdminCourseDto&gt; allCourseFromAdmin(Integer adminId) {
<span class="nc" id="L52">            AdminDao adminDao = DaoProvider.getInstance().getAdminDao();</span>
<span class="nc" id="L53">            List&lt;AdminCourseDto&gt; courseFromAdmin = null;</span>
<span class="nc" id="L54">            courseFromAdmin = adminDao.showAllCourseAdmin(adminId).stream()</span>
<span class="nc" id="L55">                    .map(AdminCourseDto::new)</span>
<span class="nc" id="L56">                    .collect(Collectors.toList());</span>
<span class="nc" id="L57">            adminDao.closeDao();</span>
<span class="nc" id="L58">            return courseFromAdmin;</span>
    }


    /**
     *
     */
    @Override
    public void createCourse(String nameCourse)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L69">                DaoProvider.getInstance().getCourseDao();</span>
<span class="nc" id="L70">        Course course = Course.builder()</span>
<span class="nc" id="L71">                .courseProgram(nameCourse)</span>
<span class="nc" id="L72">                .build();</span>
<span class="nc" id="L73">        courseEntityDao.save(course);</span>
<span class="nc" id="L74">        courseEntityDao.closeDao();</span>
<span class="nc" id="L75">    }</span>

    /**
     * @param idCourse
     */
    @Override
    public void deleteCourseById(int idCourse)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L84">                DaoProvider.getInstance().getCourseDao();</span>
<span class="nc" id="L85">        List&lt;Course&gt; listCourse = courseEntityDao.findAll();</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">        for (int i = 0; i &lt; listCourse.size(); i++) {</span>
<span class="nc" id="L87">            System.out.println((listCourse.get(i)).toString());</span>
        }
<span class="nc" id="L89">        System.out.println(</span>
                &quot;Choose id of a mentor which do you prefer dismiss:&quot;);

<span class="nc bnc" id="L92" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null) {</span>
<span class="nc" id="L93">            courseEntityDao.delete(idCourse);</span>
<span class="nc" id="L94">            System.out.println(&quot;Course deleted with a input id.&quot;);</span>
        } else {
<span class="nc" id="L96">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L98">        courseEntityDao.closeDao();</span>
<span class="nc" id="L99">    }</span>

    /**
     *
     */
    @Override
    public void deleteCourseByName()
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L108">                DaoProvider.getInstance().getCourseDao();</span>
<span class="nc" id="L109">        List&lt;Course&gt; listCourse = courseEntityDao.findAll();</span>
<span class="nc bnc" id="L110" title="All 2 branches missed.">        for (int i = 0; i &lt; listCourse.size(); i++) {</span>
<span class="nc" id="L111">            System.out.println((listCourse.get(i)).toString());</span>
        }
<span class="nc" id="L113">        System.out.println(</span>
                &quot;Choose id of a course which do you prefer dismiss:&quot;);

<span class="nc" id="L116">        int idCourse = scanner.nextInt();</span>

<span class="nc bnc" id="L118" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null) {</span>
<span class="nc" id="L119">            courseEntityDao.delete(idCourse);</span>
<span class="nc" id="L120">            System.out.println(&quot;Course deleted.&quot;);</span>
        }

<span class="nc" id="L123">        courseEntityDao.closeDao();</span>
<span class="nc" id="L124">    }</span>

    /**
     *
     */
    @Override
    public void createMentor(String nameMentor)
            throws SecurityException {
        mentorEntityDao =
<span class="nc" id="L133">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc" id="L134">        Mentor mentor = Mentor.builder()</span>
<span class="nc" id="L135">                .mentorName(nameMentor)</span>
<span class="nc" id="L136">                .build();</span>
<span class="nc" id="L137">        mentorEntityDao.save(mentor);</span>
<span class="nc" id="L138">        mentorEntityDao.closeDao();</span>
<span class="nc" id="L139">    }</span>

    /**
     * @param idMentor
     */
    @Override
    public void deleteMentorById(int idMentor)
            throws SecurityException {
        mentorEntityDao =
<span class="nc" id="L148">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc bnc" id="L149" title="All 2 branches missed.">        if (mentorEntityDao.findById(idMentor) != null) {</span>
<span class="nc" id="L150">            mentorEntityDao.delete(idMentor);</span>
<span class="nc" id="L151">            System.out.println(&quot;Mentor deleted with a input id.&quot;);</span>
        } else {
<span class="nc" id="L153">            System.out.println(&quot;Mentor doesn't exist!&quot;);</span>
        }
<span class="nc" id="L155">        mentorEntityDao.closeDao();</span>
<span class="nc" id="L156">    }</span>

    /**
     *
     */
    @Override
    public void deleteMentorByName()
            throws SecurityException {
        mentorEntityDao =
<span class="nc" id="L165">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc" id="L166">        List&lt;Mentor&gt; listMentor = mentorEntityDao.findAll();</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">        for (int i = 0; i &lt; listMentor.size(); i++) {</span>
<span class="nc" id="L168">            System.out.println((listMentor.get(i)).toString());</span>
        }
<span class="nc" id="L170">        System.out.println(</span>
                &quot;Choose id of a mentor which do you prefer dismiss:&quot;);
<span class="nc" id="L172">        int idMentor = scanner.nextInt();</span>
<span class="nc bnc" id="L173" title="All 2 branches missed.">        if (mentorEntityDao.findById(idMentor) != null) {</span>
<span class="nc" id="L174">            List&lt;Course&gt; courseList = getListMentor(mentorEntityDao</span>
<span class="nc" id="L175">                    .findById(idMentor).getMentorName());</span>
<span class="nc bnc" id="L176" title="All 2 branches missed.">            for (Course course : courseList) {</span>
<span class="nc" id="L177">                course.setMentorField(null);</span>
<span class="nc" id="L178">                courseEntityDao.update(course);</span>
<span class="nc" id="L179">            }</span>
<span class="nc" id="L180">            mentorEntityDao.delete(idMentor);</span>
<span class="nc" id="L181">            System.out.println(&quot;Mentor deleted.&quot;);</span>
        }
<span class="nc" id="L183">        mentorEntityDao.closeDao();</span>
<span class="nc" id="L184">    }</span>

    /**
     *
     */
    @Override
    public void insertMentorToCourse(int idCourse, int idMentor)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L193">                DaoProvider.getInstance().getCourseDao();</span>
        mentorEntityDao =
<span class="nc" id="L195">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc bnc" id="L196" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">                &amp;&amp; mentorEntityDao.findById(idMentor) != null) {</span>
<span class="nc" id="L198">            Course course = courseEntityDao.findById(idCourse);</span>
<span class="nc" id="L199">            Mentor mentor = mentorEntityDao.findById(idMentor);</span>
<span class="nc" id="L200">            course.setMentorField(mentor);</span>
<span class="nc" id="L201">            courseEntityDao.save(course);</span>
<span class="nc" id="L202">            System.out.println(&quot;Mentor was added on course&quot;);</span>
<span class="nc" id="L203">        } else {</span>
<span class="nc" id="L204">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L206">        courseEntityDao.closeDao();</span>
<span class="nc" id="L207">    }</span>

    /**
     * @param idAdmin
     */
    @Override
    public void takeCourseForControl(int idAdmin)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L216">                DaoProvider.getInstance().getCourseDao();</span>
        adminEntityDao =
<span class="nc" id="L218">                DaoProvider.getInstance().getAdminDao();</span>
<span class="nc" id="L219">        System.out.println(&quot;Введите id курса:&quot;);</span>
<span class="nc" id="L220">        int idCourse = scanner.nextInt();</span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">                &amp;&amp; adminEntityDao.findById(idAdmin) != null) {</span>
<span class="nc" id="L223">            Course course = courseEntityDao.findById(idCourse);</span>
<span class="nc" id="L224">            Admin admin = adminEntityDao.findById(idAdmin);</span>
<span class="nc" id="L225">            course.setAdminField(admin);</span>
<span class="nc" id="L226">            courseEntityDao.save(course);</span>
<span class="nc" id="L227">            System.out.println(&quot;Admin was added on course&quot;);</span>
<span class="nc" id="L228">        } else {</span>
<span class="nc" id="L229">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L231">        courseEntityDao.closeDao();</span>

<span class="nc" id="L233">    }</span>

    @Override
    public void updateMentorToCourse(int idCourse, int idMentor)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L239">                DaoProvider.getInstance().getCourseDao();</span>
        mentorEntityDao =
<span class="nc" id="L241">                DaoProvider.getInstance().getMentorDao();</span>
<span class="nc bnc" id="L242" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">                &amp;&amp; mentorEntityDao.findById(idMentor) != null) {</span>
<span class="nc" id="L244">            Course course = courseEntityDao.findById(idCourse);</span>
<span class="nc" id="L245">            Mentor mentor = mentorEntityDao.findById(idMentor);</span>
<span class="nc" id="L246">            course.setMentorField(mentor);</span>
<span class="nc" id="L247">            courseEntityDao.update(course);</span>
<span class="nc" id="L248">            System.out.println(&quot;Update mentor.&quot;);</span>
<span class="nc" id="L249">        } else {</span>
<span class="nc" id="L250">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L252">        courseEntityDao.closeDao();</span>
<span class="nc" id="L253">    }</span>

    @Override
    public void updateAdminToCourse(int idCourse, int idAdmin)
            throws SecurityException {
        courseEntityDao =
<span class="nc" id="L259">                DaoProvider.getInstance().getCourseDao();</span>
        adminEntityDao =
<span class="nc" id="L261">                DaoProvider.getInstance().getAdminDao();</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">        if (courseEntityDao.findById(idCourse) != null</span>
<span class="nc bnc" id="L263" title="All 2 branches missed.">                &amp;&amp; adminEntityDao.findById(idAdmin) != null) {</span>
<span class="nc" id="L264">            Course course = courseEntityDao.findById(idCourse);</span>
<span class="nc" id="L265">            Admin admin = adminEntityDao.findById(idAdmin);</span>
<span class="nc" id="L266">            course.setAdminField(admin);</span>
<span class="nc" id="L267">            courseEntityDao.update(course);</span>
<span class="nc" id="L268">            System.out.println(&quot;Update admin.&quot;);</span>
<span class="nc" id="L269">        } else {</span>
<span class="nc" id="L270">            System.out.println(&quot;Course doesn't exist!&quot;);</span>
        }
<span class="nc" id="L272">        courseEntityDao.closeDao();</span>
<span class="nc" id="L273">    }</span>

    private List&lt;Course&gt; getListMentor(String mentor)
            throws SecurityException {
<span class="nc" id="L277">        EntityManager entityManager = HibernateUtil.getEntityManager();</span>
<span class="nc" id="L278">        Query query = entityManager</span>
<span class="nc" id="L279">                .createQuery(&quot;SELECT E.courses FROM Mentor E &quot; +</span>
                        &quot;WHERE E.mentorName = :mentor&quot;);
<span class="nc" id="L281">        query.setParameter(&quot;mentor&quot;, mentor);</span>
<span class="nc" id="L282">        List&lt;Course&gt; courseList = query.getResultList();</span>
<span class="nc" id="L283">        entityManager.close();</span>
<span class="nc" id="L284">        return courseList;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>